<%# /courses/:id %>
<% if @course.main_image.attached? %>
  <%= image_tag @course.main_image %>
<% end %>
<%= @course.title %>
By <%= link_to @course.username, user_url(@course.user_id) %>
Rating: <%= @course.ratings.average(:value) || "Not rated yet!" %>

<% if @course.user_id == session[:user_id] %>
  <%= link_to "Edit Course", edit_course_path %>
  <%= link_to "Add Post", new_course_post_path(@course) %>
<% else %>
  <% if @subscription.valid? %>
    
    <%= button_to 'Unsubscribe', course_subscription_path(@course, @subscription), method: :delete, class: 'p-button' %>
    <%= link_to "See Posts", course_posts_path(@course) %>

    <%= form_for [@course, @rating] do |f| %>
      <%= f.select(:value, options_for_select([1,2,3,4,5])) %>
      <%= f.submit %>
    <% end %>
    <% if @rating.valid? %>
      <%= button_to 'Delete Rating', course_rating_path(@course, @rating), method: :delete %>
    <% end %>

  <% else %>
    
    <%= button_to "Subscribe",  course_subscriptions_path(@course, @subscription), method: :create, class: 'p-button' %>
    <p>Please subscribe to see posts</p>

  <% end %>
<% end %>
